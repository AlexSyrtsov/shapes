var P=Object.defineProperty;var O=(r,e,t)=>e in r?P(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var s=(r,e,t)=>(O(r,typeof e!="symbol"?e+"":e,t),t);import{V as l,P as x,S as v,W as H,R as j,a as p,T as g,C as M,A as T,b as R,c as E,d as I,M as m,G as A,e as S,f as U,O as G,g as z,B as D,L as W,h as N,i as V,j as _}from"./vendor.f9404ab1.js";const B=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}};B();const F=(r,e,t)=>r*e*Math.sin(t[0].angleTo(t[1])),X=(r,e,t)=>r.distanceTo(t[e+1<t.length?e+1:0]),b=r=>{const[e,t,n]=r;return new l(e.x+n.x-t.x,e.y+n.y-t.y,e.z-t.z+n.z)};class C{constructor(e,t,n){s(this,"element");s(this,"parent");s(this,"parentType");s(this,"position");s(this,"camera");const i=document.createElement("div");i.className="text-label",this.element=i,this.parentType=e,this.parent=t,this.camera=n,this.position=new l(0,0,0),this.element.innerHTML=this.getHTML()}update(){this.position.copy(this.parent.position),this.element.innerHTML=this.getHTML();const e=this.get2DCoords(this.position,this.camera);this.element.style.left=e.x+"px",this.element.style.top=e.y+"px"}get2DCoords(e,t){const n=e.project(t);return n.x=(n.x+1)/2*window.innerWidth,n.y=-(n.y-1)/2*window.innerHeight,n}getHTML(){return`
        <p>Element: ${this.parentType};</p>
        <p>X: ${this.parent.position.x.toFixed()};</p>
        <p>Y: ${this.parent.position.y.toFixed()};</p>
        <p>Z: ${this.parent.position.z.toFixed()};</p>
      `}}const Y=14474460,$=15790320,k=16777215,q=0,K=16711680,Z=255,J=16776960;class Q{constructor(){s(this,"container");s(this,"camera");s(this,"scene");s(this,"renderer");s(this,"raycaster");s(this,"pointer");s(this,"onUpPosition");s(this,"onDownPosition");s(this,"geometry");s(this,"transformControl");s(this,"controls");s(this,"vectorHelper");s(this,"positionHelper");s(this,"pointsObjects");s(this,"pointsLabels");s(this,"circleLabel");s(this,"positions");s(this,"circle");s(this,"parallelogram");s(this,"isInfoVisible");s(this,"infoContainer");this.container=document.getElementById("app"),this.camera=new x(70,window.innerWidth/window.innerHeight,1,1e4),this.scene=new v,this.renderer=new H({antialias:!0}),this.raycaster=new j,this.pointer=new p,this.onUpPosition=new p,this.onDownPosition=new p,this.geometry=new g(11,1,30,45,7),this.vectorHelper=new l,this.positionHelper=new l,this.pointsObjects=[],this.pointsLabels=[],this.positions=[],this.circleLabel=null,this.transformControl=null,this.controls=null,this.circle=null,this.parallelogram=null,this.isInfoVisible=!1,this.infoContainer=null}setUpSceneAndCamera(){this.scene.background=new M(Y),this.camera.position.set(0,250,1e3),this.scene.add(this.camera),this.scene.add(new T($));const e=new R(k,1.5);e.position.set(0,1500,200),e.angle=Math.PI*.2,e.castShadow=!0,e.shadow.camera.near=200,e.shadow.camera.far=2e3,e.shadow.bias=-222e-6,e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,this.scene.add(e)}setUpPlane(){const e=new E(2e3,2e3);e.rotateX(-Math.PI/2);const t=new I({color:q,opacity:.2}),n=new m(e,t);n.position.y=-200,n.receiveShadow=!0,this.scene.add(n)}setUpGrid(){const e=new A(2e3,10);e.position.y=-199,this.scene.add(e)}setUpGui(){const e=new S;console.log(e),e.add({Reset:this.removePoints.bind(this)},"Reset"),e.add({About:this.toggleInfo.bind(this)},"About"),e.open()}setUpControls(){this.transformControl=new U(this.camera,this.renderer.domElement),this.controls=new G(this.camera,this.renderer.domElement),this.controls.addEventListener("change",this.render.bind(this)),this.transformControl.addEventListener("change",this.render.bind(this)),this.transformControl.addEventListener("dragging-changed",this.onDragChange.bind(this)),this.scene.add(this.transformControl),this.transformControl.addEventListener("objectChange",this.onObjectChange.bind(this))}onDragChange(e){this.controls&&(this.controls.enabled=!e.value)}init(){var e;this.setUpSceneAndCamera(),this.setUpPlane(),this.setUpGrid(),this.setUpGui(),this.setUpControls(),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,(e=this.container)==null||e.appendChild(this.renderer.domElement),document.addEventListener("pointerdown",this.onPointerDown.bind(this)),document.addEventListener("pointerup",this.onPointerUp.bind(this)),document.addEventListener("pointermove",this.onPointerMove.bind(this)),window.addEventListener("resize",this.onWindowResize.bind(this)),this.render()}onObjectChange(e){if(this.pointsObjects.length===4){let t=this.pointsObjects.findIndex(d=>d.uuid===e.target.object.uuid),n=[],i=t;t===3?(i=0,n=[1,2,3]):t===2?(i=3,n=[0,1,2]):t===1?(i=2,n=[3,0,1]):t===0&&(i=1,n=[2,3,0]);const o=this.pointsObjects[n[0]].position,a=this.pointsObjects[n[1]].position,c=this.pointsObjects[n[2]].position,h=b([o,a,c]);this.pointsObjects[i].position.set(h.x,h.y,h.z)}this.updateHelpers()}addPointObject(e,t){var a;const n=new z({color:K}),i=new m(this.geometry,n);i.position.copy(e),i.castShadow=!0,i.receiveShadow=!0,this.scene.add(i),this.pointsObjects.push(i);const o=new C(`Point ${t}`,i,this.camera);return this.pointsLabels.push(o),(a=this.container)==null||a.appendChild(o.element),i}addPoint(e,t){this.positions.push(this.addPointObject(e,t).position),this.updateHelpers(),this.render()}removePoints(){var e,t,n;for(let i=0;i<this.pointsObjects.length;i++){(e=this.container)==null||e.removeChild(this.pointsLabels[i].element);const o=this.pointsObjects[i];((t=this.transformControl)==null?void 0:t.object)===o&&this.transformControl.detach(),this.scene.remove(o)}this.circleLabel&&((n=this.container)==null||n.removeChild(this.circleLabel.element)),this.pointsObjects=[],this.pointsLabels=[],this.circleLabel=null,this.positions=[],this.updateHelpers(),this.render()}updateHelpers(){this.circle&&this.scene.remove(this.circle),this.parallelogram&&this.scene.remove(this.parallelogram),this.pointsObjects.length===4&&this.drawParalleloramAndCircle()}drawParalleloramAndCircle(){var f,u;const e=new D().setFromPoints([...this.positions,this.positions[0]]),t=new W({color:Z});this.parallelogram=new N(e,t);const[n,i,o]=this.positions.map(X).sort(),a=F(n,o,this.positions);this.scene.add(this.parallelogram);const c=new V;c.setFromPoints(this.positions);const h=c.getCenter(new l),d=Math.sqrt(a/Math.PI),L=new g(d,1,16,100),y=new _({color:J});this.circle=new m(L,y),this.circle.position.copy(h),this.scene.add(this.circle),this.circleLabel&&((f=this.container)==null||f.removeChild(this.circleLabel.element),this.circleLabel=null);const w=new C("Circle",this.circle,this.camera);this.circleLabel=w,(u=this.container)==null||u.appendChild(w.element)}render(){var e;for(let t=0;t<this.pointsLabels.length;t++)this.pointsLabels[t].update();(e=this.circleLabel)==null||e.update(),this.renderer.render(this.scene,this.camera)}onPointerDown(e){this.onDownPosition.x=e.clientX,this.onDownPosition.y=e.clientY}onPointerUp(e){if(!e.target.closest(".lil-gui")&&(this.onUpPosition.x=e.clientX,this.onUpPosition.y=e.clientY,this.onDownPosition.distanceTo(this.onUpPosition)===0)){if(this.pointsObjects.length<=2){this.vectorHelper.set(e.clientX/window.innerWidth*2-1,-(e.clientY/window.innerHeight)*2+1,.5),this.vectorHelper.unproject(this.camera),this.vectorHelper.sub(this.camera.position).normalize();const t=-this.camera.position.z/this.vectorHelper.z;this.positionHelper.copy(this.camera.position).add(this.vectorHelper.multiplyScalar(t)),this.addPoint(this.positionHelper,this.pointsObjects.length+1),this.pointsObjects.length===3&&this.addPoint(b(this.positions),4)}this.transformControl&&this.transformControl.detach()}}onPointerMove(e){this.pointer.x=e.clientX/window.innerWidth*2-1,this.pointer.y=-(e.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(this.pointer,this.camera);const t=this.raycaster.intersectObjects(this.pointsObjects,!1);if(t.length>0){const n=t[0].object;this.transformControl&&n!==this.transformControl.object&&this.transformControl.attach(n)}}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight),this.render()}toggleInfo(){var e,t;this.isInfoVisible=!this.isInfoVisible,this.isInfoVisible?(this.infoContainer=document.createElement("div"),this.infoContainer.className="info-container",this.infoContainer.innerHTML=`
        <p>The program allows you to create a parallelogram at three points and get a circle whose area and center correspond to the area and center of the parallelogram. This program can be used in WebAR and VR, for marking up various data (for example, manual marking of a lidar map for subsequent training of a neural network).</p>
        </br>
        <p>Author - Alexander Syrtsov</p>
        <p>e-mail - <a href="mailto:alexander.publicity@gmail.com">alexander.publicity@gmail.com</a></p>

      `,(e=this.container)==null||e.appendChild(this.infoContainer)):((t=this.container)==null||t.removeChild(this.infoContainer),this.infoContainer=null),console.log(this.isInfoVisible)}}window.onload=()=>new Q().init();
